"use strict";angular.module("forumApp",["ngRoute"]).config(["$routeProvider",function(a){a.otherwise({redirectTo:"/"}),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/question/:id",{templateUrl:"views/question.html",controller:"QuestionCtrl"})}]).factory("questionFactory",["$http","$routeParams",function(a,b){var c={},d="http://0.0.0.0:3002/questions";return c.getQuestions=function(){return a.get(d)},c.getNextTenQuestions=function(b){return a.get(d+"/nextTenQuestions/"+b)},c.getQuestionById=function(b){return a.get(d+"/"+b)},c.addQuestion=function(b){return a.post(d,b)},c.updateQuestion=function(c){return a.put(d+"/"+b.id,c)},c.upVoteQuestion=function(b){return a.put(d+"/upvote/"+b)},c.dnVoteQuestion=function(b){return a.put(d+"/dnvote/"+b)},c.deleteQuestion=function(b){return a.delete(d+"/"+b)},c.questions={numberOfRequestsForQuestions:1,questionsList:[]},c.getNextTenQuestions(0).success(function(a){c.questions.questionList=a}).error(function(a){console.log("Unable to load questions: "+a.message)}),c}]).factory("commentFactory",["$http","$routeParams",function(a,b){var c={},d="http://0.0.0.0:3002/comments";return c.getComments=function(b){return a.get(d+"/"+b)},c.addComment=function(b,c){return a.post(d+"/"+b,c)},c.updateComment=function(c){return a.put(d+"/"+b.id,c)},c.upVoteComment=function(b){return a.put(d+"/upvote/"+b)},c.dnVoteComment=function(b){return a.put(d+"/dnvote/"+b)},c.deleteComment=function(b){return a.delete(d+"/"+b)},c}]).factory("socketFactory",["$rootScope",function(a){var b=io.connect("http://0.0.0.0:3002/");return{on:function(c,d){b.on(c,function(){var c=arguments;a.$apply(function(){d.apply(b,c)})})},emit:function(c,d,e){b.emit(c,d,function(){console.log("args -"+arguments);var c=arguments;a.$apply(function(){e&&e.apply(b,c)})})}}}]).factory("toolboxFactory",[function(){var a={};return a.findObjectInArray=function(a,b,c){for(var d=0,e=a.length;e>d;d++)if(a[d][b]===c)return{referenceToObject:a[d],objectPosition:d};return{referenceToObject:-1,objectPosition:-1}},a.documentHeight=function(){var a=document;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))},a.scrollMax=function(b){window.onscroll=function(){window.innerHeight+window.scrollY+20>=a.documentHeight()&&b()}},a}]),angular.module("forumApp").controller("MainCtrl",["$scope","$routeParams","$timeout","questionFactory","toolboxFactory",function(a,b,c,d,e){var f=!0;a.questions=d.questions,e.scrollMax(function(){f===!0&&(f=!1,a.$apply(function(){d.getNextTenQuestions(d.questions.numberOfRequestsForQuestions).success(function(a){d.questions.questionList=d.questions.questionList.concat(a),d.questions.numberOfRequestsForQuestions++,c(function(){f=!0},500)}).error(function(b){a.status="Unable to load questions: "+b.message})}))}),a.deleteQuestion=function(a){d.deleteQuestion(a);var b=e.findObjectInArray(d.questions.questionList,"_id",a).objectPosition;-1!==b&&d.questions.questionList.splice(b,1)},a.upVote=function(a){d.upVoteQuestion(a);var b=e.findObjectInArray(d.questions.questionList,"_id",a);b.referenceToObject.score+=1},a.dnVote=function(a){d.dnVoteQuestion(a);var b=e.findObjectInArray(d.questions.questionList,"_id",a);b.referenceToObject.score-=1}}]),angular.module("forumApp").controller("QuestionCtrl",["$scope","$routeParams","questionFactory","commentFactory","socketFactory","toolboxFactory",function(a,b,c,d,e,f){var g=b.id;a.previousComments=[],d.getComments(g).success(function(b){a.previousComments=b,console.log(a.previousComments)}).error(function(a){console.log("Unable to load comments: "+a.message)}),a.comments=[],e.emit("enter discussion",{username:"bobby",question_id:g}),e.on("new message",function(b){b.question_id===g&&(a.comments=a.comments.concat(b),i===!0&&$("html, body").animate({scrollTop:$(document).height()},"slow"))}),a.editedQuestion={},c.getQuestionById(g).success(function(b){a.question=b,a.editedQuestion.title=a.question.title,a.editedQuestion.author=a.question.author,a.editedQuestion.comment=a.question.comment}).error(function(b){a.status="Unable to load questions: "+b.message}),a.updateQuestion=function(){c.updateQuestion(a.editedQuestion).success(function(){console.log(a.editedQuestion),a.question.title=a.editedQuestion.title,a.question.author=a.editedQuestion.author,a.question.comment=a.editedQuestion.comment;var b=f.findObjectInArray(c.questions.questionList,"_id",g);b.referenceToObject.title=a.editedQuestion.title,b.referenceToObject.author=a.editedQuestion.author,b.referenceToObject.comment=a.editedQuestion.comment,a.status="Question uploaded"}).error(function(b){a.status="Unable to load questions: "+b.message})},a.addComment=function(){if(""!==a.newComment){var b={question_id:g,author:"sherbinator2014 ",message:a.newComment};$("html, body").animate({scrollTop:$(document).height()-1},"slow"),d.addComment(g,b),e.emit("message sent",b),a.comments=a.comments.concat(b),a.newComment=""}},a.deleteComment=function(b){d.deleteComment(b);var c=-1;c=f.findObjectInArray(a.comments,"_id",b).objectPosition,-1!==c?a.comments.splice(c,1):(c=f.findObjectInArray(a.previousComments,"_id",b).objectPosition,-1!==c&&a.previousComments.splice(c,1))};var h=!0;$(".reply-box").on("keydown",function(b){13===b.which&&h&&(b.preventDefault(),a.$apply(a.addComment()))});var i=!1,j=function(){i=!1,$(".messager").animate({bottom:"-145px"},200),$(".contribute").animate({bottom:"55px",right:"90px",opacity:1},200),$("#cross").css({"-webkit-transform":"rotate(0deg)","-moz-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)",transform:"rotate(0deg)"})},k=function(){i=!0,$(".messager").animate({bottom:"0px"},200),$(".contribute").animate({bottom:"155px",right:"50%",opacity:1},200),$("#cross").css({"-webkit-transform":"rotate(45deg)","-moz-transform":"rotate(45deg)","-ms-transform":"rotate(45deg)",transform:"rotate(45deg)"})};$(".contribute").click(function(){i?j():k()})}]),angular.module("forumApp").controller("NewQuestionCtrl",["$scope","$routeParams","questionFactory",function(a,b,c){var d=!1,e=function(){d=!1,$(".writer").animate({bottom:"-145px"},200),$(".contribute").animate({bottom:"55px",right:"90px",opacity:1},200),$("#cross").css({"-webkit-transform":"rotate(0deg)","-moz-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)",transform:"rotate(0deg)"})},f=function(){d=!0,$(".writer").animate({bottom:"0px"},200),$(".contribute").animate({bottom:"155px",right:"50%",opacity:1},200),$("#cross").css({"-webkit-transform":"rotate(45deg)","-moz-transform":"rotate(45deg)","-ms-transform":"rotate(45deg)",transform:"rotate(45deg)"})};$(".contribute").click(function(){d?e():f()}),a.addQuestion=function(){c.addQuestion(a.newPost).success(function(){e(),a.newPost.title="",a.newPost.author="",a.newPost.comment=""}).error(function(b){a.status="Unable to load questions: "+b.message})}}]);